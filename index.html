<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>3D Snow Ornaments</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background:
        radial-gradient(circle at top, #1b4f7b 0, #0b1b2b 40%, #05060a 100%);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    #sceneCanvas {
      width: 100%;
      height: 100%;
      display: block;
    }
    .hint {
      position: fixed;
      left: 50%;
      bottom: 20px;
      transform: translateX(-50%);
      color: rgba(255,255,255,0.7);
      font-size: 11px;
      letter-spacing: .08em;
      text-transform: uppercase;
      pointer-events: none;
      user-select: none;
    }
  </style>
</head>
<body>
  <canvas id="sceneCanvas"></canvas>
  <div class="hint">Move your mouse · drag · scroll</div>

  <script type="module">
    import * as THREE from "https://unpkg.com/three@0.162.0/build/three.module.js";
    import { GLTFLoader } from "https://unpkg.com/three@0.162.0/examples/jsm/loaders/GLTFLoader.js";

    const canvas   = document.getElementById("sceneCanvas");
    const renderer = new THREE.WebGLRenderer({
      canvas,
      antialias: true,
      alpha: true
    });
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.outputEncoding = THREE.sRGBEncoding;

    const scene = new THREE.Scene();

    // Kamera
    const camera = new THREE.PerspectiveCamera(
      35,
      window.innerWidth / window.innerHeight,
      0.1,
      100
    );
    camera.position.set(0, 0.8, 8);
    scene.add(camera);

    // Işıklar
    const hemi = new THREE.HemisphereLight(0xffffff, 0x223344, 0.8);
    hemi.position.set(0, 1, 0);
    scene.add(hemi);

    const dir = new THREE.DirectionalLight(0xffffff, 1.1);
    dir.position.set(4, 6, 4);
    dir.castShadow = true;
    scene.add(dir);

    // Hafif sis
    scene.fog = new THREE.FogExp2(0x05060a, 0.09);

    // Zemin (çok belli olmayan soft bir plane)
    const groundGeo = new THREE.PlaneGeometry(40, 40);
    const groundMat = new THREE.MeshPhongMaterial({
      color: 0x111111,
      transparent: true,
      opacity: 0.15
    });
    const ground = new THREE.Mesh(groundGeo, groundMat);
    ground.rotation.x = -Math.PI / 2;
    ground.position.y = -2;
    scene.add(ground);

    // GLB modeller
    const loader = new GLTFLoader();
    const modelUrls = [
      "https://raw.githubusercontent.com/archysketch/3dscene/main/christmas_ball.glb",
      "https://raw.githubusercontent.com/archysketch/3dscene/main/christmas_tree_ball.glb"
    ];

    const floatingObjects = [];

    function addModelInstances(gltf, count, baseScale = 1) {
      gltf.scene.traverse(obj => {
        if (obj.isMesh) {
          obj.castShadow = true;
          obj.receiveShadow = true;
          if (obj.material) {
            obj.material.metalness = 0.5;
            obj.material.roughness = 0.3;
          }
        }
      });

      for (let i = 0; i < count; i++) {
        const m = gltf.scene.clone(true);
        const spread = 4.0;

        m.position.set(
          (Math.random() - 0.5) * spread * 2,
          -0.5 + Math.random() * 3.0,
          (Math.random() - 0.5) * spread
        );

        const s = baseScale * (0.6 + Math.random() * 0.7);
        m.scale.setScalar(s);

        m.rotation.set(
          Math.random() * Math.PI,
          Math.random() * Math.PI,
          Math.random() * Math.PI
        );

        scene.add(m);

        floatingObjects.push({
          mesh: m,
          yOffset: Math.random() * Math.PI * 2,
          rotSpeed: (Math.random() * 0.6 - 0.3),
          amp: 0.25 + Math.random() * 0.35
        });
      }
    }

    // Modelleri sırayla yükle
    modelUrls.forEach((url, idx) => {
      loader.load(
        url,
        gltf => {
          // İlk modelden daha fazla, ikinciden biraz daha az koyduk
          const count = idx === 0 ? 10 : 8;
          const baseScale = idx === 0 ? 0.9 : 1.1;
          addModelInstances(gltf, count, baseScale);
        },
        undefined,
        err => {
          console.error("Model yüklenemedi:", url, err);
        }
      );
    });

    // Mouse etkileşimi
    let mouseX = 0, mouseY = 0;
    let targetCamX = 0, targetCamY = 0;

    window.addEventListener("pointermove", (e) => {
      const nx = (e.clientX / window.innerWidth) * 2 - 1;
      const ny = (e.clientY / window.innerHeight) * 2 - 1;
      mouseX = nx;
      mouseY = ny;
    });

    // Hafif kamera zoom için scroll
    window.addEventListener("wheel", (e) => {
      camera.position.z += e.deltaY * 0.002;
      camera.position.z = THREE.MathUtils.clamp(camera.position.z, 5, 12);
    }, { passive: true });

    // Resize
    window.addEventListener("resize", () => {
      const w = window.innerWidth;
      const h = window.innerHeight;
      camera.aspect = w / h;
      camera.updateProjectionMatrix();
      renderer.setSize(w, h);
    });

    // Animasyon döngüsü
    let clock = new THREE.Clock();

    function animate() {
      requestAnimationFrame(animate);

      const t = clock.getElapsedTime();

      // Kamera mouse’a doğru hafifçe kaysın
      targetCamX = mouseX * 1.5;
      targetCamY = mouseY * 0.8;

      camera.position.x += (targetCamX - camera.position.x) * 0.06;
      camera.position.y += (-0.3 + targetCamY - camera.position.y) * 0.06;
      camera.lookAt(0, 0.3, 0);

      // Objeleri yumuşakça yüzdür
      for (const obj of floatingObjects) {
        const m = obj.mesh;
        const tt = t + obj.yOffset;
        m.position.y += Math.sin(tt) * 0.004 * obj.amp;
        m.rotation.y += 0.005 + obj.rotSpeed * 0.01;
        m.rotation.x += 0.003 * Math.sin(tt * 0.7);
      }

      renderer.render(scene, camera);
    }

    animate();
  </script>
</body>
</html>
